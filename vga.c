#include <dos.h>
#include <stdio.h>
#include <conio.h>

unsigned char mode13h[] = {
0x63, 0x03, 0x01, 0x0F, 0x00, 0x0E, 0x5F, 0x4F,
0x50, 0x82, 0x54, 0x80, 0xBF, 0x1F, 0x00, 0x41,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x9C, 0x0E,
0x8F, 0x28, 0x40, 0x96, 0xB9, 0xA3, 0xFF, 0x00,
0x00, 0x00, 0x00, 0x00, 0x40, 0x05, 0x0F, 0xFF,
0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,
0x41, 0x00, 0x0F, 0x00, 0x00
};
unsigned char reg;
unsigned char pal[3*16] = {
0x00, 0x00, 0x00,
0x00, 0x00, 0x2a,
0x00, 0x2a, 0x00,
0x00, 0x2a, 0x2a,
0x2a, 0x00, 0x00,
0x2a, 0x00, 0x2a,
0x2a, 0x15, 0x00,
0x2a, 0x2a, 0x2a,
0x15, 0x15, 0x15,
0x15, 0x15, 0x3f,
0x15, 0x3f, 0x15,
0x15, 0x3f, 0x3f,
0x3f, 0x15, 0x15,
0x3f, 0x15, 0x3f,
0x3f, 0x3f, 0x15,
0x3f, 0x3f, 0x3f
};

void write_regs(unsigned char *regs) {
  int i;
  outp(0x3c2, *regs);
  regs++;

  for(i=0; i<0x05; i++) {
    outp(0x3c4, i);
    outp(0x3c5, *regs);
    regs++;
  }

  outp(0x3d4, 0x11);
  outp(0x3d5, regs[23]-0x80);
  for(i=0; i<0x19; i++) {
    outp(0x3d4, i);
    outp(0x3d5, *regs);
    regs++;
  }
  outp(0x3d4, 0x11);
  outp(0x3d5, regs[23]);

  for(i=0; i<0x09; i++) {
    outp(0x3ce, i);
    outp(0x3cf, *regs);
    regs++;
  }

  for(i=0; i<0x15; i++) {
    (void)inp(0x3da);
    outp(0x3c0, i);
    outp(0x3c0, *regs);
    regs++;
  }

  (void)inp(0x3da);
  outp(0x3c0, 0x20);
}

int main() {
  unsigned char c;
  int i, j, k, fd;
  unsigned char far *vga = (unsigned char far *)MK_FP(0xA000, 0);

  outp(0x60, 0xf3);
  outp(0x60, 0x7f);
  j = inp(0x21);
  outp(0x21, 255);

  while(c!=1+0x80) {
    while((inp(0x64)&1)==1) {
      c = inp(0x60);
      printf("%d\n", c);
    }
  }

  write_regs(mode13h);
  for(i=0; i<256; i++) {
    outp(0x3c8, i);
    outp(0x3c9, i&63);
    outp(0x3c9, i&63);
    outp(0x3c9, i&63);
  }
  for(i=0; i<64000; i++)
    vga[i] = i&255;

  return 0;
}
